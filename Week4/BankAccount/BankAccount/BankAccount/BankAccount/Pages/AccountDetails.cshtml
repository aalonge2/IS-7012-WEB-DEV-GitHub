@page
@model AccountDetailsModel
@{
    ViewData["Title"] = "Account Details";
}

@if (Model.Account == null)
{
    <h2 class="text-danger">Account not found.</h2>
}
else
{
    <h1>Account @Model.Account.Number</h1>
    <p><strong>Owner:</strong> @Model.Account.Owner</p>
    <p><strong>Balance:</strong> @string.Format("{0:C}", Model.Account.Balance)</p>

    <h3 class="mt-4">New Transaction</h3>
    <form method="post" class="row g-3">
        <input type="hidden" asp-for="Id" />

        <div class="col-md-3">
            <label asp-for="IsDeposit" class="form-label">Type</label>
            <select asp-for="IsDeposit" class="form-select">
                <option value="true">Deposit</option>
                <option value="false">Withdrawal</option>
            </select>
        </div>

        <div class="col-md-3">
            <label asp-for="Amount" class="form-label"></label>
            <input asp-for="Amount" class="form-control" />
            <span asp-validation-for="Amount" class="text-danger"></span>
        </div>

        <div class="col-md-4">
            <label asp-for="Note" class="form-label"></label>
            <input asp-for="Note" class="form-control" />
        </div>

        <div class="col-md-2 d-flex align-items-end">
            <button type="submit" class="btn btn-primary">Submit</button>
        </div>
    </form>

    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="alert alert-danger mt-3">@Model.ErrorMessage</div>
    }

    <h3 class="mt-5">Transactions</h3>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Date</th>
                <th>Amount</th>
                <th>Note</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Account.Transactions.Any())
            {
                foreach (var t in Model.Account.Transactions.OrderByDescending(t => t.Date))
                {
                    <tr>
                        <td>@t.Date.ToString("g")</td>
                        <td>@string.Format("{0:C}", t.Amount)</td>
                        <td>@t.Note</td>
                    </tr>
                }
            }
            else
            {
                <tr><td colspan="3" class="text-muted">No transactions yet.</td></tr>
            }
        </tbody>
    </table>

    <p>
        <a class="btn btn-secondary" href="/Index">Back to Accounts</a>
    </p>
}
